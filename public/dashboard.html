<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <h1>Dashboard</h1>
    <button id="logoutBtn">Logout</button>
  </header>

  <main>
    <p id="usernameDisplay"></p>
    <p>Points: <span id="points"></span></p>
    <p>Badges: <span id="badges"></span></p>
    <a href="game.html">Play Game</a>
  </main>

  <script type="module">
    import { auth, db } from './js/firebase-config.js';
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { protectPage, logoutAndRedirect } from './js/authGuard.js';

    protectPage(); // protect dashboard

    document.getElementById('logoutBtn').addEventListener('click', logoutAndRedirect);

    // Display user info
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        const userSnap = await getDoc(doc(db, 'users', user.uid));
        if (userSnap.exists()) {
          const data = userSnap.data();
          document.getElementById('usernameDisplay').textContent = data.username;
          document.getElementById('points').textContent = data.points ?? 0;
          document.getElementById('badges').textContent = (data.badges || []).join(', ') || 'None';
        }
      }
    });
  </script>
</body>
</html>
